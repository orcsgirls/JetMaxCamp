<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MQTT Send Command</title>
<script src="js/mqttws31.min.js" type="text/javascript"></script>

<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  button, range, input { margin: 0px; margin-bottom:10px; padding: 5px 20px; font-size: 16px; }
  #statusLight { width: 20px; height: 20px; border-radius: 50%; display: inline-block; margin-left: 10px; }
  #console { margin-top: 20px; background: #111; color: #0f0; padding: 10px; height: 200px; overflow-y: scroll; font-family: monospace; }}
</style>
</head>

<body>
<h2>MQTT Send Command</span></h2>
<div>
  Topic: <input type="text" id="topic" /><br>
  Value: <input type="text" id="msg" />
  <button onclick="sendCommand()">Send</button>
  
  <br>
 </div>
<div id="console"></div>

<script>
  //--------------------------------------------------------------------------------------------
  // Configure here
  //--------------------------------------------------------------------------------------------
  
  const host = "192.168.37.111"; // your broker IP
  const port = 8083; // common WebSocket port (adjust if different)
  const clientId = "conveyorUI-" + Math.random().toString(16).substr(2, 8);
  
  //--------------------------------------------------------------------------------------------
  
  const client = new Paho.MQTT.Client(host, Number(port), "/mqtt", clientId);

  client.onMessageArrived = onMessageArrived;

  client.connect({
    useSSL: false,
    onSuccess: onConnect,
    onFailure: (err) => log("Connection failed: " + JSON.stringify(err))
  });

  function onConnect() {
    log("Connected to broker");
    client.subscribe("#");
  }

  function onMessageArrived(message) {
    log("Message arrived: [" + message.destinationName + "] " + message.payloadString);
  }

  function sendCommand() {
    let cmd = document.getElementById("msg").value;
    let topic = document.getElementById("topic").value;
	console.log(topic, cmd);
    const message = new Paho.MQTT.Message(cmd);
    message.destinationName = topic
    client.send(message);
    log("Sent command: " + cmd + " to " + topic);
  }

  function log(msg) {
    const consoleDiv = document.getElementById("console");
    consoleDiv.innerHTML += "<div>> " + msg + "</div>";
    consoleDiv.scrollTop = consoleDiv.scrollHeight;
  }
</script>
</body>
</html>
